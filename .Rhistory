data, panel_params, coord, na.rm = na.rm
), text = ggproto_parent(GeomText, self)$draw_panel(
data, panel_params, coord, na.rm = na.rm,
parse = parse, check_overlap = check_overlap
)
)
##Silently drop lines with less than two points, preserving order
rows <- stats::ave(seq_len(nrow(munched)), munched$group, FUN = length)
munched <- munched[rows >= 2, ]
if (nrow(munched) < 2) {
return(zeroGrob())
}
munched <- transform(munched,
xend = c(tail(x, -1), NA),
yend = c(tail(y, -1), NA),
keep = c(group[-1] == head(group, -1), FALSE))
munched <- munched[munched$keep, ]
my_path <- grid::grob(
x0 = unit(munched$x, "npc"), x1 = unit(munched$xend, "npc"),
y0 = unit(munched$y, "npc"), y1 = unit(munched$yend, "npc"),
mult = (munched$size * .pt + munched$stroke * .stroke / 2) * munched$gap,
name = "trail",
gp = grid::gpar(
col = alpha(munched$colour, munched$alpha),
fill = alpha(munched$colour, munched$alpha),
lwd = munched$linesize * .pt,
lty = munched$linetype,
lineend = "butt",
linejoin = "round",
linemitre = 10
),
vp = NULL,
cl = "trail"
)
ggplot2:::ggname(
"geom_trail",
grid::grobTree(my_path, my_points)
)
},
non_missing_aes = c("size", "colour")
)
GeomTrail <- ggplot2::ggproto(
"GeomTrail", ggplot2::GeomPoint,
switch(type,
point = default_aes = ggplot2::aes(
shape = 19, colour = "black", gap = .9, size = 1.5, fill = NA,
alpha = NA, stroke = 0.5, linesize = 0.5, linetype = 1),
text = default_aes = aes(gap = .9, linesize = 0.5, linetype = 1,
stroke = 0.5, colour = "black", size = 3.88, angle = 0, hjust = 0.5,
vjust = 0.5, alpha = NA, family = "", fontface = 1, lineheight = 1.2
)),
draw_panel = function(self, data, panel_params, coord, arrow = NULL, type,
parse, check_overlap,
lineend = "butt", linejoin = "round", linemitre = 10,
na.rm = FALSE) {
if (!anyDuplicated(data$group)) {
message_wrap("geom_path: Each group consists of only one observation. ",
"Do you need to adjust the group aesthetic?")
}
##must be sorted on group
data <- data[order(data$group), , drop = FALSE]
munched <- coord_munch(coord, data, panel_params)
##Default geom point behaviour
if (is.character(data$shape)) {
data$shape <- translate_shape_string(data$shape)
}
coords <- coord$transform(data, panel_params)
my_points <-
switch(type, point = ggproto_parent(GeomPoint, self)$draw_panel(
data, panel_params, coord, na.rm = na.rm
), text = ggproto_parent(GeomText, self)$draw_panel(
data, panel_params, coord, na.rm = na.rm,
parse = parse, check_overlap = check_overlap
)
)
##Silently drop lines with less than two points, preserving order
rows <- stats::ave(seq_len(nrow(munched)), munched$group, FUN = length)
munched <- munched[rows >= 2, ]
if (nrow(munched) < 2) {
return(zeroGrob())
}
munched <- transform(munched,
xend = c(tail(x, -1), NA),
yend = c(tail(y, -1), NA),
keep = c(group[-1] == head(group, -1), FALSE))
munched <- munched[munched$keep, ]
my_path <- grid::grob(
x0 = unit(munched$x, "npc"), x1 = unit(munched$xend, "npc"),
y0 = unit(munched$y, "npc"), y1 = unit(munched$yend, "npc"),
mult = (munched$size * .pt + munched$stroke * .stroke / 2) * munched$gap,
name = "trail",
gp = grid::gpar(
col = alpha(munched$colour, munched$alpha),
fill = alpha(munched$colour, munched$alpha),
lwd = munched$linesize * .pt,
lty = munched$linetype,
lineend = "butt",
linejoin = "round",
linemitre = 10
),
vp = NULL,
cl = "trail"
)
ggplot2:::ggname(
"geom_trail",
grid::grobTree(my_path, my_points)
)
},
non_missing_aes = c("size", "colour")
)
styler:::style_selection()
GeomTrail <- ggplot2::ggproto(
"GeomTrail", ggplot2::GeomPoint,
if(type == "point"){
default_aes = ggplot2::aes(
shape = 19, colour = "black", gap = .9, size = 1.5, fill = NA,
alpha = NA, stroke = 0.5, linesize = 0.5, linetype = 1)
} else if (type == "text"){
default_aes = ggplot2::aes(gap = .9, linesize = 0.5, linetype = 1,
stroke = 0.5, colour = "black", size = 3.88, angle = 0, hjust = 0.5,
vjust = 0.5, alpha = NA, family = "", fontface = 1, lineheight = 1.2
)
},
draw_panel = function(self, data, panel_params, coord, arrow = NULL, type,
parse, check_overlap,
lineend = "butt", linejoin = "round", linemitre = 10,
na.rm = FALSE) {
if (!anyDuplicated(data$group)) {
message_wrap("geom_path: Each group consists of only one observation. ",
"Do you need to adjust the group aesthetic?")
}
##must be sorted on group
data <- data[order(data$group), , drop = FALSE]
munched <- coord_munch(coord, data, panel_params)
##Default geom point behaviour
if (is.character(data$shape)) {
data$shape <- translate_shape_string(data$shape)
}
coords <- coord$transform(data, panel_params)
my_points <-
switch(type, point = ggproto_parent(GeomPoint, self)$draw_panel(
data, panel_params, coord, na.rm = na.rm
), text = ggproto_parent(GeomText, self)$draw_panel(
data, panel_params, coord, na.rm = na.rm,
parse = parse, check_overlap = check_overlap
)
)
##Silently drop lines with less than two points, preserving order
rows <- stats::ave(seq_len(nrow(munched)), munched$group, FUN = length)
munched <- munched[rows >= 2, ]
if (nrow(munched) < 2) {
return(zeroGrob())
}
munched <- transform(munched,
xend = c(tail(x, -1), NA),
yend = c(tail(y, -1), NA),
keep = c(group[-1] == head(group, -1), FALSE))
munched <- munched[munched$keep, ]
my_path <- grid::grob(
x0 = unit(munched$x, "npc"), x1 = unit(munched$xend, "npc"),
y0 = unit(munched$y, "npc"), y1 = unit(munched$yend, "npc"),
mult = (munched$size * .pt + munched$stroke * .stroke / 2) * munched$gap,
name = "trail",
gp = grid::gpar(
col = alpha(munched$colour, munched$alpha),
fill = alpha(munched$colour, munched$alpha),
lwd = munched$linesize * .pt,
lty = munched$linetype,
lineend = "butt",
linejoin = "round",
linemitre = 10
),
vp = NULL,
cl = "trail"
)
ggplot2:::ggname(
"geom_trail",
grid::grobTree(my_path, my_points)
)
},
non_missing_aes = c("size", "colour")
)
GeomTrail <- ggplot2::ggproto(
"GeomTrail", ggplot2::GeomPoint,
default_aes = ggplot2::aes(
shape = 19, colour = "black", gap = .9, size = 1.5, fill = NA,
alpha = NA, stroke = 0.5,
linesize = 0.5, linetype = 1, label = NA, angle = 0,
hjust = 0.5, vjust = 0.5, family = "", fontface = 1, lineheight = 1.2
),
draw_panel = function(self, data, panel_params, coord, arrow = NULL, type,
parse, check_overlap,
lineend = "butt", linejoin = "round", linemitre = 10,
na.rm = FALSE) {
if (!anyDuplicated(data$group)) {
message_wrap("geom_path: Each group consists of only one observation. ",
"Do you need to adjust the group aesthetic?")
}
##must be sorted on group
data <- data[order(data$group), , drop = FALSE]
munched <- coord_munch(coord, data, panel_params)
##Default geom point behaviour
if (is.character(data$shape)) {
data$shape <- translate_shape_string(data$shape)
}
coords <- coord$transform(data, panel_params)
my_points <-
switch(type, point = ggproto_parent(GeomPoint, self)$draw_panel(
data, panel_params, coord, na.rm = na.rm
), text = ggproto_parent(GeomText, self)$draw_panel(
data, panel_params, coord, na.rm = na.rm,
parse = parse, check_overlap = check_overlap
)
)
##Silently drop lines with less than two points, preserving order
rows <- stats::ave(seq_len(nrow(munched)), munched$group, FUN = length)
munched <- munched[rows >= 2, ]
if (nrow(munched) < 2) {
return(zeroGrob())
}
munched <- transform(munched,
xend = c(tail(x, -1), NA),
yend = c(tail(y, -1), NA),
keep = c(group[-1] == head(group, -1), FALSE))
munched <- munched[munched$keep, ]
my_path <- grid::grob(
x0 = unit(munched$x, "npc"), x1 = unit(munched$xend, "npc"),
y0 = unit(munched$y, "npc"), y1 = unit(munched$yend, "npc"),
mult = (munched$size * .pt + munched$stroke * .stroke / 2) * munched$gap,
name = "trail",
gp = grid::gpar(
col = alpha(munched$colour, munched$alpha),
fill = alpha(munched$colour, munched$alpha),
lwd = munched$linesize * .pt,
lty = munched$linetype,
lineend = "butt",
linejoin = "round",
linemitre = 10
),
vp = NULL,
cl = "trail"
)
ggplot2:::ggname(
"geom_trail",
grid::grobTree(my_path, my_points)
)
},
non_missing_aes = c("size", "colour")
)
p + geom_trail(aes(group = A, label = as.character(round(C,1))), type = "text")
p + geom_trail(aes(group = A, label = round(C,1)), type = "text")
p + geom_trail(aes(group = A, label = round(C,1)), type = "text", size = 10)
p + geom_trail(aes(group = A, label = round(C,1)), type = "text", size = 2)
p + geom_trail(aes(group = A, label = round(C,1)), type = "text", size = 2,
gap = .3)
p + geom_trail(aes(group = A, label = round(C,1)), type = "text", size = 5,
gap = .3)
p + geom_trail(aes(group = A, label = round(C,1)), type = "text", size = 8*5/14,
gap = .3)
p + geom_trail()
p <-  testdf %>% arrange(A,B) %>%
ggplot( aes(B, C, color = A))
p + geom_trail()
GeomTrail <- ggplot2::ggproto(
"GeomTrail", ggplot2::GeomPoint,
default_aes = ggplot2::aes(
shape = 19, colour = "black", gap = .9, size = 1.5, fill = NA,
alpha = NA, stroke = 0.5,
linesize = 0.5, linetype = 1, label = NA, angle = 0,
hjust = 0.5, vjust = 0.5, family = "", fontface = 1, lineheight = 1.2
),
draw_panel = function(self, data, panel_params, coord, arrow = NULL, type,
parse, check_overlap,
lineend = "butt", linejoin = "round", linemitre = 10,
na.rm = FALSE) {
if (!anyDuplicated(data$group)) {
ggplot2:::message_wrap("geom_path: Each group consists of only one observation. ",
"Do you need to adjust the group aesthetic?")
}
##must be sorted on group
data <- data[order(data$group), , drop = FALSE]
munched <- coord_munch(coord, data, panel_params)
##Default geom point behaviour
if (is.character(data$shape)) {
data$shape <- translate_shape_string(data$shape)
}
coords <- coord$transform(data, panel_params)
my_points <-
switch(type, point = ggproto_parent(GeomPoint, self)$draw_panel(
data, panel_params, coord, na.rm = na.rm
), text = ggproto_parent(GeomText, self)$draw_panel(
data, panel_params, coord, na.rm = na.rm,
parse = parse, check_overlap = check_overlap
)
)
##Silently drop lines with less than two points, preserving order
rows <- stats::ave(seq_len(nrow(munched)), munched$group, FUN = length)
munched <- munched[rows >= 2, ]
if (nrow(munched) < 2) {
return(zeroGrob())
}
munched <- transform(munched,
xend = c(tail(x, -1), NA),
yend = c(tail(y, -1), NA),
keep = c(group[-1] == head(group, -1), FALSE))
munched <- munched[munched$keep, ]
my_path <- grid::grob(
x0 = unit(munched$x, "npc"), x1 = unit(munched$xend, "npc"),
y0 = unit(munched$y, "npc"), y1 = unit(munched$yend, "npc"),
mult = (munched$size * .pt + munched$stroke * .stroke / 2) * munched$gap,
name = "trail",
gp = grid::gpar(
col = alpha(munched$colour, munched$alpha),
fill = alpha(munched$colour, munched$alpha),
lwd = munched$linesize * .pt,
lty = munched$linetype,
lineend = "butt",
linejoin = "round",
linemitre = 10
),
vp = NULL,
cl = "trail"
)
ggplot2:::ggname(
"geom_trail",
grid::grobTree(my_path, my_points)
)
},
non_missing_aes = c("size", "colour")
)
p <-  testdf %>% arrange(A,B) %>%
ggplot( aes(B, C, color = A))
p + geom_trail(aes(group = A, label = round(C,1)),
type = "text", size = 8*5/14,
gap = .3)
p + geom_trail()
p + geom_trail(type = "point")
GeomTrail <- ggplot2::ggproto(
"GeomTrail", ggplot2::GeomPoint,
default_aes = ggplot2::aes(
shape = 19, colour = "black", gap = .9, size = 1.5, fill = NA,
alpha = NA, stroke = 0.5,
linesize = 0.5, linetype = 1, label = NA, angle = 0,
hjust = 0.5, vjust = 0.5, family = "", fontface = 1, lineheight = 1.2
),
draw_panel = function(self, data, panel_params, coord, arrow = NULL, type,
parse, check_overlap,
lineend = "butt", linejoin = "round", linemitre = 10,
na.rm = FALSE) {
if (!anyDuplicated(data$group)) {
ggplot2:::message_wrap("geom_path: Each group consists of only one observation. ",
"Do you need to adjust the group aesthetic?")
}
##must be sorted on group
data <- data[order(data$group), , drop = FALSE]
munched <- coord_munch(coord, data, panel_params)
##Default geom point behaviour
if (is.character(data$shape)) {
data$shape <- translate_shape_string(data$shape)
}
coords <- coord$transform(data, panel_params)
my_points <-
switch(type, point = ggproto_parent(GeomPoint, self)$draw_panel(
data, panel_params, coord, na.rm = na.rm
), text = ggproto_parent(GeomText, self)$draw_panel(
data, panel_params, coord, na.rm = na.rm,
parse = parse, check_overlap = check_overlap
)
)
##Silently drop lines with less than two points, preserving order
rows <- stats::ave(seq_len(nrow(munched)), munched$group, FUN = length)
munched <- munched[rows >= 2, ]
if (nrow(munched) < 2) {
my_path <- zeroGrob()
} else {
munched <- transform(munched,
xend = c(tail(x, -1), NA),
yend = c(tail(y, -1), NA),
keep = c(group[-1] == head(group, -1), FALSE))
munched <- munched[munched$keep, ]
my_path <- grid::grob(
x0 = unit(munched$x, "npc"), x1 = unit(munched$xend, "npc"),
y0 = unit(munched$y, "npc"), y1 = unit(munched$yend, "npc"),
mult = (munched$size * .pt + munched$stroke * .stroke / 2) * munched$gap,
name = "trail",
gp = grid::gpar(
col = alpha(munched$colour, munched$alpha),
fill = alpha(munched$colour, munched$alpha),
lwd = munched$linesize * .pt,
lty = munched$linetype,
lineend = "butt",
linejoin = "round",
linemitre = 10
),
vp = NULL,
cl = "trail"
)
}
ggplot2:::ggname(
"geom_trail",
grid::grobTree(my_path, my_points)
)
},
non_missing_aes = c("size", "colour")
)
p + geom_trail(aes(group = A, label = round(C,1)),
type = "text", size = 8*5/14,
gap = .3)
p + geom_trail(type = "point")
testdf <- structure(list(A = c("(75,85", "(75,85", "(75,85", "(75,85",
"(75,85", "(75,85", "(75,85", "(75,85", "(75,85", "(85,95", "(85,95",
"(85,95", "(85,95", "(85,95", "(85,95", "(85,95", "(85,95", "(85,95",
"(95,105", "(95,105", "(95,105", "(95,105", "(95,105", "(95,105",
"(95,105", "(95,105", "(95,105"), B = c("0", "180", "270", "360",
"450", "540", "630", "720", "90", "0", "180", "270", "360", "450",
"540", "630", "720", "90", "0", "180", "270", "360", "450", "540",
"630", "720", "90"), C = c(57.4992967651196, 61.5562760537286,
61.3364097831103, 61.2489177489177, 61.8064171122995, 62.0222355769231,
62.1152291105121, 62.4370314842579, 61.0354914196568, 56.34151547492,
60.8717557251908, 59.6534508076358, 59.1148936170213, 60.2280071813285,
59.5571428571429, 60.0696055684455, 59.7123287671233, 59.9706572769953,
53.6289752650177, 56.3720930232558, 56.4319248826291, 54.5657894736842,
56.4674556213018, 55.9864864864865, 56.625, 58.2210526315789,
55.8153846153846)), row.names = c(NA, -27L), class = c("tbl_df",
"tbl", "data.frame"))
p <-  testdf %>% arrange(A,B) %>%
ggplot( aes(B, C, color = A))
p + geom_trail(type = "point")
p <-  testdf %>% arrange(A,B) %>%
ggplot( aes(B, C, color = A, group = A))
p + geom_trail(aes( label = round(C,1)),
type = "text", size = 8*5/14,
gap = .3)
p + geom_trail(type = "point")
GeomTrail <- ggplot2::ggproto(
"GeomTrail", ggplot2::GeomPoint,
default_aes = ggplot2::aes(
shape = 19, colour = "black", gap = .9, size = 1.5, fill = NA,
alpha = NA, stroke = 0.5,
linesize = 0.5, linetype = 1, label = NA, angle = 0,
hjust = 0.5, vjust = 0.5, family = "", fontface = 1, lineheight = 1.2
),
draw_panel = function(self, data, panel_params, coord, arrow = NULL, type,
parse, check_overlap,
lineend = "butt", linejoin = "round", linemitre = 10,
na.rm = FALSE) {
if (!anyDuplicated(data$group)) {
ggplot2:::message_wrap("geom_path: Each group consists of only one observation. ",
"Do you need to adjust the group aesthetic?")
}
##Default geom point behaviour
if (is.character(data$shape)) {
data$shape <- translate_shape_string(data$shape)
}
coords <- coord$transform(data, panel_params)
my_points <-
switch(type, point = ggproto_parent(GeomPoint, self)$draw_panel(
data, panel_params, coord, na.rm = na.rm
), text = ggproto_parent(GeomText, self)$draw_panel(
data, panel_params, coord, na.rm = na.rm,
parse = parse, check_overlap = check_overlap
)
)
##must be sorted on group
data <- data[order(data$group), , drop = FALSE]
munched <- coord_munch(coord, data, panel_params)
##Silently drop lines with less than two points, preserving order
rows <- stats::ave(seq_len(nrow(munched)), munched$group, FUN = length)
munched <- munched[rows >= 2, ]
if (nrow(munched) < 2) {
my_path <- zeroGrob()
} else {
munched <- transform(munched,
xend = c(tail(x, -1), NA),
yend = c(tail(y, -1), NA),
keep = c(group[-1] == head(group, -1), FALSE))
munched <- munched[munched$keep, ]
my_path <- grid::grob(
x0 = unit(munched$x, "npc"), x1 = unit(munched$xend, "npc"),
y0 = unit(munched$y, "npc"), y1 = unit(munched$yend, "npc"),
mult = (munched$size * .pt + munched$stroke * .stroke / 2) * munched$gap,
name = "trail",
gp = grid::gpar(
col = alpha(munched$colour, munched$alpha),
fill = alpha(munched$colour, munched$alpha),
lwd = munched$linesize * .pt,
lty = munched$linetype,
lineend = "butt",
linejoin = "round",
linemitre = 10
),
vp = NULL,
cl = "trail"
)
}
ggplot2:::ggname(
"geom_trail",
grid::grobTree(my_path, my_points)
)
},
non_missing_aes = c("size", "colour")
)
p + geom_trail(aes( label = round(C,1)),
type = "text", size = 8*5/14,
gap = .3)
p + geom_trail(type = "point")
p1+p1
library(ggtrail)
?geom_trail
library(ggtrail)
?geom_trail
library(ggtrail)
